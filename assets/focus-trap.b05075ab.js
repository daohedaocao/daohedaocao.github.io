import{i as F,_ as M}from"./index.ac17342c.js";import{E as U}from"./index.bff7b787.js";import{H as B,I as W,a as j,r as G,G as J,w as g,u as T,q as k,f as Y,l as z}from"./index.d15ac50b.js";import{i as Q}from"./isNil.98bb3b88.js";let h;const de=()=>{var e;if(!F)return 0;if(h!==void 0)return h;const t=document.createElement("div");t.className="el-scrollbar__wrap",t.style.visibility="hidden",t.style.width="100px",t.style.position="absolute",t.style.top="-9999px",document.body.appendChild(t);const o=t.offsetWidth;t.style.overflow="scroll";const n=document.createElement("div");n.style.width="100%",t.appendChild(n);const r=n.offsetWidth;return(e=t.parentNode)==null||e.removeChild(t),h=o-r,h};function pe(e,t){if(!F)return;if(!t){e.scrollTop=0;return}const o=[];let n=t.offsetParent;for(;n!==null&&e!==n&&e.contains(n);)o.push(n),n=n.offsetParent;const r=t.offsetTop+o.reduce((_,v)=>_+v.offsetTop,0),i=r+t.offsetHeight,d=e.scrollTop,E=d+e.clientHeight;r<d?e.scrollTop=r:i>E&&(e.scrollTop=i-e.clientHeight)}let p=[];const X=e=>{const t=o=>{const n=o;n.key===U.esc&&p.forEach(r=>r(n))};B(()=>{p.length===0&&document.addEventListener("keydown",t),F&&p.push(e)}),W(()=>{p=p.filter(o=>o!==e),p.length===0&&F&&document.removeEventListener("keydown",t)})},V=e=>{const t=[],o=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,{acceptNode:n=>{const r=n.tagName==="INPUT"&&n.type==="hidden";return n.disabled||n.hidden||r?NodeFilter.FILTER_SKIP:n.tabIndex>=0||n===document.activeElement?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;o.nextNode();)t.push(o.currentNode);return t},A=(e,t)=>{for(const o of e)if(!Z(o,t))return o},Z=(e,t)=>{if(getComputedStyle(e).visibility==="hidden")return!0;for(;e;){if(t&&e===t)return!1;if(getComputedStyle(e).display==="none")return!0;e=e.parentElement}return!1},ee=e=>{const t=V(e),o=A(t,e),n=A(t.reverse(),e);return[o,n]},te=e=>e instanceof HTMLInputElement&&"select"in e,f=(e,t)=>{if(e&&e.focus){const o=document.activeElement;e.focus({preventScroll:!0}),e!==o&&te(e)&&t&&e.select()}};function K(e,t){const o=[...e],n=e.indexOf(t);return n!==-1&&o.splice(n,1),o}const se=()=>{let e=[];return{push:n=>{const r=e[0];r&&n!==r&&r.pause(),e=K(e,n),e.unshift(n)},remove:n=>{var r,i;e=K(e,n),(i=(r=e[0])==null?void 0:r.resume)==null||i.call(r)}}},ne=(e,t=!1)=>{const o=document.activeElement;for(const n of e)if(f(n,t),document.activeElement!==o)return},R=se(),C="focus-trap.focus-after-trapped",w="focus-trap.focus-after-released",H={cancelable:!0,bubbles:!1},x="focusAfterTrapped",D="focusAfterReleased",oe=Symbol("elFocusTrap"),re=j({name:"ElFocusTrap",inheritAttrs:!1,props:{loop:Boolean,trapped:Boolean,focusTrapEl:Object,focusStartEl:{type:[Object,String],default:"first"}},emits:[x,D,"focusin","focusout","focusout-prevented","release-requested"],setup(e,{emit:t}){const o=G();let n,r;X(s=>{e.trapped&&!i.paused&&t("release-requested",s)});const i={paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}},d=s=>{if(!e.loop&&!e.trapped||i.paused)return;const{key:c,altKey:a,ctrlKey:u,metaKey:l,currentTarget:$,shiftKey:P}=s,{loop:I}=e,q=c===U.tab&&!a&&!u&&!l,m=document.activeElement;if(q&&m){const b=$,[y,S]=ee(b);y&&S?!P&&m===S?(s.preventDefault(),I&&f(y,!0),t("focusout-prevented")):P&&[y,b].includes(m)&&(s.preventDefault(),I&&f(S,!0),t("focusout-prevented")):m===b&&(s.preventDefault(),t("focusout-prevented"))}};J(oe,{focusTrapRef:o,onKeydown:d}),g(()=>e.focusTrapEl,s=>{s&&(o.value=s)},{immediate:!0}),g([o],([s],[c])=>{s&&(s.addEventListener("keydown",d),s.addEventListener("focusin",v),s.addEventListener("focusout",L)),c&&(c.removeEventListener("keydown",d),c.removeEventListener("focusin",v),c.removeEventListener("focusout",L))});const E=s=>{t(x,s)},_=s=>t(D,s),v=s=>{const c=T(o);if(!c)return;const a=s.target,u=a&&c.contains(a);u&&t("focusin",s),!i.paused&&e.trapped&&(u?r=a:f(r,!0))},L=s=>{const c=T(o);if(!(i.paused||!c))if(e.trapped){const a=s.relatedTarget;!Q(a)&&!c.contains(a)&&setTimeout(()=>{!i.paused&&e.trapped&&f(r,!0)},0)}else{const a=s.target;a&&c.contains(a)||t("focusout",s)}};async function N(){await k();const s=T(o);if(s){R.push(i);const c=document.activeElement;if(n=c,!s.contains(c)){const u=new Event(C,H);s.addEventListener(C,E),s.dispatchEvent(u),u.defaultPrevented||k(()=>{let l=e.focusStartEl;Y(l)||(f(l),document.activeElement!==l&&(l="first")),l==="first"&&ne(V(s),!0),(document.activeElement===c||l==="container")&&f(s)})}}}function O(){const s=T(o);if(s){s.removeEventListener(C,E);const c=new Event(w,H);s.addEventListener(w,_),s.dispatchEvent(c),c.defaultPrevented||f(n!=null?n:document.body,!0),s.removeEventListener(w,E),R.remove(i)}}return B(()=>{e.trapped&&N(),g(()=>e.trapped,s=>{s?N():O()})}),W(()=>{e.trapped&&O()}),{onKeydown:d}}});function ce(e,t,o,n,r,i){return z(e.$slots,"default",{handleKeydown:e.onKeydown})}var Ee=M(re,[["render",ce],["__file","/home/runner/work/element-plus/element-plus/packages/components/focus-trap/src/focus-trap.vue"]]);export{Ee as E,oe as F,de as g,pe as s};
